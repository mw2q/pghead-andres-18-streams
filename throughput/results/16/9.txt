BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%grey%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 265516175.461055
 ALGERIA                   |   1997 | 452050192.546021
 ALGERIA                   |   1996 | 453747885.371998
 ALGERIA                   |   1995 | 457869555.264519
 ALGERIA                   |   1994 | 454155076.615109
 ALGERIA                   |   1993 | 453711531.897949
 ALGERIA                   |   1992 | 452660982.343995
 ARGENTINA                 |   1998 | 273914639.964377
 ARGENTINA                 |   1997 | 475459194.552873
 ARGENTINA                 |   1996 | 472169891.751305
 ARGENTINA                 |   1995 | 460712472.992134
 ARGENTINA                 |   1994 |  462618683.15893
 ARGENTINA                 |   1993 | 464647057.581797
 ARGENTINA                 |   1992 |  463669791.79933
 BRAZIL                    |   1998 | 274681855.837916
 BRAZIL                    |   1997 | 466491463.403773
 BRAZIL                    |   1996 |  465069555.55297
 BRAZIL                    |   1995 | 464269814.193984
 BRAZIL                    |   1994 | 461572479.525109
 BRAZIL                    |   1993 | 464721460.700224
 BRAZIL                    |   1992 | 473774784.566409
 CANADA                    |   1998 | 272551253.055936
 CANADA                    |   1997 | 478379592.145577
 CANADA                    |   1996 |  475187753.47927
 CANADA                    |   1995 | 469614108.220192
 CANADA                    |   1994 | 485052218.957955
 CANADA                    |   1993 | 470082173.891076
 CANADA                    |   1992 | 471870892.852916
 CHINA                     |   1998 |   271963772.1196
 CHINA                     |   1997 | 469115723.981237
 CHINA                     |   1996 | 464836173.445878
 CHINA                     |   1995 | 464162532.456027
 CHINA                     |   1994 | 463048916.109414
 CHINA                     |   1993 | 465581291.189233
 CHINA                     |   1992 | 473156265.253272
 EGYPT                     |   1998 | 276561033.519651
 EGYPT                     |   1997 | 463381906.689293
 EGYPT                     |   1996 |   469952008.3483
 EGYPT                     |   1995 | 455458063.148683
 EGYPT                     |   1994 | 456685945.269081
 EGYPT                     |   1993 | 460219503.153285
 EGYPT                     |   1992 | 458666125.666391
 ETHIOPIA                  |   1998 | 270196652.876547
 ETHIOPIA                  |   1997 | 455872365.013928
 ETHIOPIA                  |   1996 | 457499759.003301
 ETHIOPIA                  |   1995 | 459895846.899144
 ETHIOPIA                  |   1994 | 465051854.582423
 ETHIOPIA                  |   1993 | 460954310.129904
 ETHIOPIA                  |   1992 | 463179831.815404
 FRANCE                    |   1998 | 267918762.830857
 FRANCE                    |   1997 | 456769780.039361
 FRANCE                    |   1996 | 460837310.884125
 FRANCE                    |   1995 | 459213624.896807
 FRANCE                    |   1994 | 455708076.127245
 FRANCE                    |   1993 | 449976021.990117
 FRANCE                    |   1992 | 457028231.832952
 GERMANY                   |   1998 | 282909156.835154
 GERMANY                   |   1997 | 480530946.940875
 GERMANY                   |   1996 | 472571316.080042
 GERMANY                   |   1995 | 482664071.073568
 GERMANY                   |   1994 | 481414387.369208
 GERMANY                   |   1993 | 475037873.048439
 GERMANY                   |   1992 | 469360449.151562
 INDIA                     |   1998 | 274408231.174772
 INDIA                     |   1997 | 480683951.400921
 INDIA                     |   1996 |   476764216.7605
 INDIA                     |   1995 |  467684764.21417
 INDIA                     |   1994 | 480578389.604319
 INDIA                     |   1993 | 471425468.712717
 INDIA                     |   1992 | 475549660.859898
 INDONESIA                 |   1998 | 276832021.708392
 INDONESIA                 |   1997 | 462373006.001437
 INDONESIA                 |   1996 | 461373665.046582
 INDONESIA                 |   1995 | 465620508.727365
 INDONESIA                 |   1994 | 465536931.770698
 INDONESIA                 |   1993 | 467929904.044346
 INDONESIA                 |   1992 | 466174254.261238
 IRAN                      |   1998 | 275278099.975979
 IRAN                      |   1997 | 461622544.762957
 IRAN                      |   1996 | 453054029.655645
 IRAN                      |   1995 | 457178735.213801
 IRAN                      |   1994 | 452135607.328575
 IRAN                      |   1993 | 458296190.234786
 IRAN                      |   1992 | 452815837.968177
 IRAQ                      |   1998 |  277567174.51707
 IRAQ                      |   1997 | 467169685.188511
 IRAQ                      |   1996 | 468620151.360088
 IRAQ                      |   1995 | 466248605.590015
 IRAQ                      |   1994 | 475355678.197134
 IRAQ                      |   1993 | 463337763.834557
 IRAQ                      |   1992 | 473804190.111491
 JAPAN                     |   1998 | 270322375.104453
 JAPAN                     |   1997 | 472212973.162158
 JAPAN                     |   1996 | 460523050.734595
 JAPAN                     |   1995 | 464447442.672588
 JAPAN                     |   1994 | 459768752.098529
 JAPAN                     |   1993 | 463034637.654614
 JAPAN                     |   1992 | 465209215.146448
 JORDAN                    |   1998 | 273846527.337041
 JORDAN                    |   1997 | 464682762.225521
 JORDAN                    |   1996 | 466885978.481804
 JORDAN                    |   1995 | 462724939.210295
 JORDAN                    |   1994 | 458940406.764869
 JORDAN                    |   1993 | 460140321.413025
 JORDAN                    |   1992 | 464732876.820494
 KENYA                     |   1998 | 274934486.493928
 KENYA                     |   1997 | 483370895.358836
 KENYA                     |   1996 | 485444410.233347
 KENYA                     |   1995 | 469903292.233646
 KENYA                     |   1994 | 472421817.010039
 KENYA                     |   1993 | 469082205.179599
 KENYA                     |   1992 | 474934086.746579
 MOROCCO                   |   1998 |  277792918.47763
 MOROCCO                   |   1997 | 469436461.501694
 MOROCCO                   |   1996 | 467966375.284581
 MOROCCO                   |   1995 | 470244773.726797
 MOROCCO                   |   1994 | 465790661.128827
 MOROCCO                   |   1993 | 464992491.245582
 MOROCCO                   |   1992 |  472907231.56157
 MOZAMBIQUE                |   1998 | 268546574.653085
 MOZAMBIQUE                |   1997 | 461183244.630008
 MOZAMBIQUE                |   1996 | 461551426.101359
 MOZAMBIQUE                |   1995 | 457830732.479205
 MOZAMBIQUE                |   1994 | 462951198.145954
 MOZAMBIQUE                |   1993 | 466975361.257603
 MOZAMBIQUE                |   1992 | 467626451.107338
 PERU                      |   1998 | 276155993.634015
 PERU                      |   1997 | 462276507.309911
 PERU                      |   1996 | 461968546.537201
 PERU                      |   1995 | 452241500.891215
 PERU                      |   1994 | 457639653.944591
 PERU                      |   1993 | 455374841.618904
 PERU                      |   1992 | 456157194.578958
 ROMANIA                   |   1998 | 274597867.261014
 ROMANIA                   |   1997 | 464700191.238994
 ROMANIA                   |   1996 | 465286774.571421
 ROMANIA                   |   1995 | 466518771.468782
 ROMANIA                   |   1994 | 468229297.930246
 ROMANIA                   |   1993 | 461023366.422756
 ROMANIA                   |   1992 | 466135659.900806
 RUSSIA                    |   1998 | 273979704.977479
 RUSSIA                    |   1997 | 464280051.209683
 RUSSIA                    |   1996 | 473863406.791838
 RUSSIA                    |   1995 | 470902888.400053
 RUSSIA                    |   1994 | 472461094.362231
 RUSSIA                    |   1993 | 465150504.931989
 RUSSIA                    |   1992 | 469345811.568688
 SAUDI ARABIA              |   1998 |  277834201.61193
 SAUDI ARABIA              |   1997 | 468774206.423526
 SAUDI ARABIA              |   1996 | 465172032.778847
 SAUDI ARABIA              |   1995 | 467595391.836739
 SAUDI ARABIA              |   1994 | 467266822.488539
 SAUDI ARABIA              |   1993 | 465973962.216163
 SAUDI ARABIA              |   1992 | 467443927.151536
 UNITED KINGDOM            |   1998 | 272776605.029027
 UNITED KINGDOM            |   1997 |  459954588.93091
 UNITED KINGDOM            |   1996 | 459935472.158357
 UNITED KINGDOM            |   1995 | 458696954.233919
 UNITED KINGDOM            |   1994 | 459026819.482286
 UNITED KINGDOM            |   1993 | 460848387.810044
 UNITED KINGDOM            |   1992 |  454833563.41449
 UNITED STATES             |   1998 | 272495513.724754
 UNITED STATES             |   1997 |  475835811.84899
 UNITED STATES             |   1996 | 471313682.470997
 UNITED STATES             |   1995 | 464436354.177305
 UNITED STATES             |   1994 | 469542775.684294
 UNITED STATES             |   1993 | 471433725.282653
 UNITED STATES             |   1992 | 470509495.470732
 VIETNAM                   |   1998 | 268971726.070862
 VIETNAM                   |   1997 | 462185934.011595
 VIETNAM                   |   1996 | 462405527.428671
 VIETNAM                   |   1995 |  458818214.88934
 VIETNAM                   |   1994 | 462786666.507993
 VIETNAM                   |   1993 | 466461406.156462
 VIETNAM                   |   1992 | 460405454.525701
(175 rows)

COMMIT;
COMMIT
