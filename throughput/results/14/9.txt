BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%linen%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 258532539.721822
 ALGERIA                   |   1997 | 447584019.185396
 ALGERIA                   |   1996 | 456764714.668981
 ALGERIA                   |   1995 | 455489764.120523
 ALGERIA                   |   1994 | 446588637.252632
 ALGERIA                   |   1993 | 452815691.485402
 ALGERIA                   |   1992 | 449140750.619016
 ARGENTINA                 |   1998 | 275414269.714647
 ARGENTINA                 |   1997 | 471258274.088408
 ARGENTINA                 |   1996 | 468980027.677236
 ARGENTINA                 |   1995 | 473821473.964277
 ARGENTINA                 |   1994 | 464314935.471452
 ARGENTINA                 |   1993 |  473931500.20824
 ARGENTINA                 |   1992 | 477641590.181767
 BRAZIL                    |   1998 | 277478862.870767
 BRAZIL                    |   1997 | 468772218.987264
 BRAZIL                    |   1996 | 460565222.969551
 BRAZIL                    |   1995 | 462973182.297249
 BRAZIL                    |   1994 | 463026767.778421
 BRAZIL                    |   1993 | 461316206.294263
 BRAZIL                    |   1992 | 467473261.522285
 CANADA                    |   1998 | 271667777.353605
 CANADA                    |   1997 | 476054393.412965
 CANADA                    |   1996 | 474324108.094694
 CANADA                    |   1995 | 471148192.754936
 CANADA                    |   1994 | 472551847.820907
 CANADA                    |   1993 | 475111954.900116
 CANADA                    |   1992 | 470672509.857769
 CHINA                     |   1998 | 271808803.303648
 CHINA                     |   1997 | 463956149.876489
 CHINA                     |   1996 | 463940155.413427
 CHINA                     |   1995 |  460891116.81149
 CHINA                     |   1994 | 463322177.859125
 CHINA                     |   1993 | 464387098.418158
 CHINA                     |   1992 | 469876053.511553
 EGYPT                     |   1998 |  270475906.20185
 EGYPT                     |   1997 | 458033829.127594
 EGYPT                     |   1996 | 471096113.955365
 EGYPT                     |   1995 | 461530381.597129
 EGYPT                     |   1994 | 461517646.418881
 EGYPT                     |   1993 | 458976338.088953
 EGYPT                     |   1992 | 468384723.018749
 ETHIOPIA                  |   1998 | 263999149.573256
 ETHIOPIA                  |   1997 | 451233299.286237
 ETHIOPIA                  |   1996 |  440798985.81561
 ETHIOPIA                  |   1995 | 451992869.087248
 ETHIOPIA                  |   1994 | 456403354.803828
 ETHIOPIA                  |   1993 | 446770456.323738
 ETHIOPIA                  |   1992 | 456025519.104956
 FRANCE                    |   1998 | 262611535.169956
 FRANCE                    |   1997 | 452187307.383461
 FRANCE                    |   1996 | 446548393.877293
 FRANCE                    |   1995 | 444898641.899138
 FRANCE                    |   1994 | 452289014.701785
 FRANCE                    |   1993 | 452309539.440733
 FRANCE                    |   1992 | 458183124.865993
 GERMANY                   |   1998 | 278932076.288517
 GERMANY                   |   1997 | 468764635.070233
 GERMANY                   |   1996 | 474795832.353521
 GERMANY                   |   1995 | 470898933.454067
 GERMANY                   |   1994 | 478247351.640153
 GERMANY                   |   1993 | 477122847.431654
 GERMANY                   |   1992 | 470480170.509366
 INDIA                     |   1998 | 279525611.473701
 INDIA                     |   1997 | 473730076.010407
 INDIA                     |   1996 | 475292636.868854
 INDIA                     |   1995 | 471990728.191668
 INDIA                     |   1994 |  479213251.73039
 INDIA                     |   1993 | 476104003.756307
 INDIA                     |   1992 | 481626146.375796
 INDONESIA                 |   1998 | 273362279.925378
 INDONESIA                 |   1997 | 462654814.109198
 INDONESIA                 |   1996 | 463682774.036783
 INDONESIA                 |   1995 | 459972807.582316
 INDONESIA                 |   1994 | 461083849.090657
 INDONESIA                 |   1993 | 457967936.881643
 INDONESIA                 |   1992 | 456468383.314891
 IRAN                      |   1998 | 272882022.112697
 IRAN                      |   1997 | 458078963.297867
 IRAN                      |   1996 | 469134716.165239
 IRAN                      |   1995 | 473374959.127374
 IRAN                      |   1994 | 468253371.289519
 IRAN                      |   1993 | 467498887.480843
 IRAN                      |   1992 | 467644645.843219
 IRAQ                      |   1998 | 277446212.193484
 IRAQ                      |   1997 | 473880553.826958
 IRAQ                      |   1996 |   476905662.6061
 IRAQ                      |   1995 | 477401320.325595
 IRAQ                      |   1994 | 474116391.994209
 IRAQ                      |   1993 | 477418951.345429
 IRAQ                      |   1992 | 467945437.139456
 JAPAN                     |   1998 | 268822567.422238
 JAPAN                     |   1997 | 463290335.873491
 JAPAN                     |   1996 | 459233676.529946
 JAPAN                     |   1995 | 456283332.175478
 JAPAN                     |   1994 | 462855353.642666
 JAPAN                     |   1993 | 456842358.768018
 JAPAN                     |   1992 |  453788044.82306
 JORDAN                    |   1998 | 273690578.546658
 JORDAN                    |   1997 | 460071189.822233
 JORDAN                    |   1996 | 460213980.740103
 JORDAN                    |   1995 | 463055944.369997
 JORDAN                    |   1994 | 460054687.843277
 JORDAN                    |   1993 | 461076146.130913
 JORDAN                    |   1992 |  464202558.53686
 KENYA                     |   1998 | 266870227.933242
 KENYA                     |   1997 | 463572194.098197
 KENYA                     |   1996 | 472016737.905501
 KENYA                     |   1995 | 466359530.875787
 KENYA                     |   1994 | 469892071.785017
 KENYA                     |   1993 | 463941457.348366
 KENYA                     |   1992 | 460940778.876379
 MOROCCO                   |   1998 | 270544859.951186
 MOROCCO                   |   1997 | 457908622.312762
 MOROCCO                   |   1996 | 471287014.878028
 MOROCCO                   |   1995 | 454484914.091923
 MOROCCO                   |   1994 | 455793457.330003
 MOROCCO                   |   1993 | 458519157.678079
 MOROCCO                   |   1992 | 471802785.144417
 MOZAMBIQUE                |   1998 | 272371302.928025
 MOZAMBIQUE                |   1997 | 464876034.394602
 MOZAMBIQUE                |   1996 | 463669225.406502
 MOZAMBIQUE                |   1995 |  464842781.84896
 MOZAMBIQUE                |   1994 | 460015101.777116
 MOZAMBIQUE                |   1993 | 466652101.816812
 MOZAMBIQUE                |   1992 | 457752644.408237
 PERU                      |   1998 | 268413361.186068
 PERU                      |   1997 | 467908825.482908
 PERU                      |   1996 | 464184357.477659
 PERU                      |   1995 | 471954824.462365
 PERU                      |   1994 | 467703276.038789
 PERU                      |   1993 | 463952224.563091
 PERU                      |   1992 | 475978400.694431
 ROMANIA                   |   1998 | 275713583.814705
 ROMANIA                   |   1997 | 460971614.421511
 ROMANIA                   |   1996 | 476410280.235783
 ROMANIA                   |   1995 | 468548427.756584
 ROMANIA                   |   1994 | 473441235.984192
 ROMANIA                   |   1993 | 464779047.983076
 ROMANIA                   |   1992 | 466378369.925577
 RUSSIA                    |   1998 | 269969267.029875
 RUSSIA                    |   1997 | 466885565.326972
 RUSSIA                    |   1996 | 463802063.246651
 RUSSIA                    |   1995 | 464609893.222419
 RUSSIA                    |   1994 | 455941306.582545
 RUSSIA                    |   1993 | 459938022.329913
 RUSSIA                    |   1992 | 469195471.506641
 SAUDI ARABIA              |   1998 | 273243676.605156
 SAUDI ARABIA              |   1997 | 463062942.928975
 SAUDI ARABIA              |   1996 | 471799258.244553
 SAUDI ARABIA              |   1995 | 470591002.336389
 SAUDI ARABIA              |   1994 | 460491961.950755
 SAUDI ARABIA              |   1993 | 468478845.193682
 SAUDI ARABIA              |   1992 | 464063048.923102
 UNITED KINGDOM            |   1998 | 273183522.811604
 UNITED KINGDOM            |   1997 |  472053113.64673
 UNITED KINGDOM            |   1996 | 465779205.643339
 UNITED KINGDOM            |   1995 | 465840491.025285
 UNITED KINGDOM            |   1994 | 462715820.236921
 UNITED KINGDOM            |   1993 | 454617863.357208
 UNITED KINGDOM            |   1992 | 461599280.271698
 UNITED STATES             |   1998 | 279190514.560715
 UNITED STATES             |   1997 | 467596797.322839
 UNITED STATES             |   1996 | 471758027.866265
 UNITED STATES             |   1995 | 474057506.733414
 UNITED STATES             |   1994 | 480335062.705362
 UNITED STATES             |   1993 | 469397735.279687
 UNITED STATES             |   1992 | 472731392.681638
 VIETNAM                   |   1998 | 273994805.774281
 VIETNAM                   |   1997 | 463388618.319863
 VIETNAM                   |   1996 |  472867950.30245
 VIETNAM                   |   1995 | 463110907.524597
 VIETNAM                   |   1994 | 469524211.991069
 VIETNAM                   |   1993 | 469279246.929821
 VIETNAM                   |   1992 | 469071718.631728
(175 rows)

COMMIT;
COMMIT
